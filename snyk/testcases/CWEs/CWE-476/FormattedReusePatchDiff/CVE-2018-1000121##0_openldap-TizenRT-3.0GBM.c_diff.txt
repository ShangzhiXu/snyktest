--- /home/V1SCAN/CWE-476/FormattedUsed/openldap-TizenRT-3.0GBM.c	2023-12-06 03:51:44.499718453 +0900
+++ /home/V1SCAN/CWE-476/FormattedPatch/NEW##CVE-2018-1000121##0##curl@@curl##openldap.c	2023-12-06 03:51:44.899725199 +0900
@@ -23,17 +23,17 @@
 
 #include "curl_setup.h"
 
-#if !defined(CONFIG_DISABLE_LDAP) && defined(CONFIG_USE_OPENLDAP)
+#if !defined(CURL_DISABLE_LDAP) && defined(USE_OPENLDAP)
 
 /*
- * Notice that CONFIG_USE_OPENLDAP is only a source code selection switch. When
- * libcurl is built with CONFIG_USE_OPENLDAP defined the libcurl source code
- * that gets compiled is the code from openldap.c, otherwise the code that gets
+ * Notice that USE_OPENLDAP is only a source code selection switch. When
+ * libcurl is built with USE_OPENLDAP defined the libcurl source code that
+ * gets compiled is the code from openldap.c, otherwise the code that gets
  * compiled is the code from ldap.c.
  *
- * When CONFIG_USE_OPENLDAP is defined a recent version of the OpenLDAP library
+ * When USE_OPENLDAP is defined a recent version of the OpenLDAP library
  * might be required for compilation and runtime. In order to use ancient
- * OpenLDAP library versions, CONFIG_USE_OPENLDAP shall not be defined.
+ * OpenLDAP library versions, USE_OPENLDAP shall not be defined.
  */
 
 #include <ldap.h>
@@ -462,7 +462,7 @@
 
   for (ent = ldap_first_message(li->ld, msg); ent;
        ent = ldap_next_message(li->ld, ent)) {
-    struct berval bv, *bvals, **bvp = &bvals;
+    struct berval bv, *bvals;
     int binary = 0, msgtype;
     CURLcode writeerr;
 
@@ -521,9 +521,9 @@
     }
     data->req.bytecount += bv.bv_len + 5;
 
-    for (rc = ldap_get_attribute_ber(li->ld, ent, ber, &bv, bvp);
-         rc == LDAP_SUCCESS;
-         rc = ldap_get_attribute_ber(li->ld, ent, ber, &bv, bvp)) {
+    for (rc = ldap_get_attribute_ber(li->ld, ent, ber, &bv, &bvals);
+         (rc == LDAP_SUCCESS) && bvals;
+         rc = ldap_get_attribute_ber(li->ld, ent, ber, &bv, &bvals)) {
       int i;
 
       if (bv.bv_val == NULL)
@@ -704,4 +704,4 @@
                                 ldapsb_tls_write, ldapsb_tls_close};
 #endif /* USE_SSL */
 
-#endif /* !CONFIG_DISABLE_LDAP && CONFIG_USE_OPENLDAP */
+#endif /* !CURL_DISABLE_LDAP && USE_OPENLDAP */
