--- /home/V1SCAN/CWE-476/FormattedVul/OLD##CVE-2018-1000121##0##curl@@curl##openldap.c	2023-12-06 03:48:08.722280592 +0900
+++ /home/V1SCAN/CWE-476/FormattedPatch/NEW##CVE-2018-1000121##0##curl@@curl##openldap.c	2023-12-06 03:48:09.172281929 +0900
@@ -462,7 +462,7 @@
 
   for (ent = ldap_first_message(li->ld, msg); ent;
        ent = ldap_next_message(li->ld, ent)) {
-    struct berval bv, *bvals, **bvp = &bvals;
+    struct berval bv, *bvals;
     int binary = 0, msgtype;
     CURLcode writeerr;
 
@@ -521,9 +521,9 @@
     }
     data->req.bytecount += bv.bv_len + 5;
 
-    for (rc = ldap_get_attribute_ber(li->ld, ent, ber, &bv, bvp);
-         rc == LDAP_SUCCESS;
-         rc = ldap_get_attribute_ber(li->ld, ent, ber, &bv, bvp)) {
+    for (rc = ldap_get_attribute_ber(li->ld, ent, ber, &bv, &bvals);
+         (rc == LDAP_SUCCESS) && bvals;
+         rc = ldap_get_attribute_ber(li->ld, ent, ber, &bv, &bvals)) {
       int i;
 
       if (bv.bv_val == NULL)
