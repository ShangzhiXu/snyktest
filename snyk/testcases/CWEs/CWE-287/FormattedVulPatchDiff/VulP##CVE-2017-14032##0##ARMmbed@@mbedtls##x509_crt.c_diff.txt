--- /home/V1SCAN/CWE-287/FormattedVul/OLD##CVE-2017-14032##0##ARMmbed@@mbedtls##x509_crt.c	2023-12-12 04:54:11.229941011 +0900
+++ /home/V1SCAN/CWE-287/FormattedPatch/NEW##CVE-2017-14032##0##ARMmbed@@mbedtls##x509_crt.c	2023-12-12 04:54:11.399942498 +0900
@@ -2047,11 +2047,13 @@
   mbedtls_x509_sequence *cur = NULL;
   mbedtls_pk_type_t pk_type;
 
-  if (profile == NULL)
-    return (MBEDTLS_ERR_X509_BAD_INPUT_DATA);
-
   *flags = 0;
 
+  if (profile == NULL) {
+    ret = MBEDTLS_ERR_X509_BAD_INPUT_DATA;
+    goto exit;
+  }
+
   if (cn != NULL) {
     name = &crt->subject;
     cn_len = strlen(cn);
@@ -2113,7 +2115,7 @@
     ret = x509_crt_verify_top(crt, parent, ca_crl, profile, pathlen, selfsigned,
                               flags, f_vrfy, p_vrfy);
     if (ret != 0)
-      return (ret);
+      goto exit;
   } else {
     /* Look for a parent upwards the chain */
     for (parent = crt->next; parent != NULL; parent = parent->next)
@@ -2125,15 +2127,21 @@
       ret = x509_crt_verify_child(crt, parent, trust_ca, ca_crl, profile,
                                   pathlen, selfsigned, flags, f_vrfy, p_vrfy);
       if (ret != 0)
-        return (ret);
+        goto exit;
     } else {
       ret = x509_crt_verify_top(crt, trust_ca, ca_crl, profile, pathlen,
                                 selfsigned, flags, f_vrfy, p_vrfy);
       if (ret != 0)
-        return (ret);
+        goto exit;
     }
   }
 
+exit:
+  if (ret != 0) {
+    *flags = (uint32_t)-1;
+    return (ret);
+  }
+
   if (*flags != 0)
     return (MBEDTLS_ERR_X509_CERT_VERIFY_FAILED);
 
