--- /home/V1SCAN/CWE-787/FormattedVul/OLD##CVE-2022-33099##0##lua@@lua##ldebug.c	2023-12-06 04:37:18.260322834 +0900
+++ /home/V1SCAN/CWE-787/FormattedPatch/NEW##CVE-2022-33099##0##lua@@lua##ldebug.c	2023-12-06 04:37:19.980318624 +0900
@@ -794,8 +794,11 @@
   va_start(argp, fmt);
   msg = luaO_pushvfstring(L, fmt, argp); /* format message */
   va_end(argp);
-  if (isLua(ci)) /* if Lua function, add source:line information */
+  if (isLua(ci)) { /* if Lua function, add source:line information */
     luaG_addinfo(L, msg, ci_func(ci)->p->source, getcurrentline(ci));
+    setobjs2s(L, L->top - 2, L->top - 1); /* remove 'msg' from the stack */
+    L->top--;
+  }
   luaG_errormsg(L);
 }
 
