--- /home/V1SCAN/CWE-787/FormattedVul/OLD##CVE-2018-8800##0##rdesktop@@rdesktop##bitmap.c	2023-12-06 04:37:17.280325232 +0900
+++ /home/V1SCAN/CWE-787/FormattedPatch/NEW##CVE-2018-8800##0##rdesktop@@rdesktop##bitmap.c	2023-12-06 04:37:19.010320999 +0900
@@ -628,14 +628,14 @@
           replen = revcode;
           collen = 0;
         }
-        while (collen > 0) {
+        while (indexw < width && collen > 0) {
           color = CVAL(in);
           *out = color;
           out += 4;
           indexw++;
           collen--;
         }
-        while (replen > 0) {
+        while (indexw < width && replen > 0) {
           *out = color;
           out += 4;
           indexw++;
@@ -652,7 +652,7 @@
           replen = revcode;
           collen = 0;
         }
-        while (collen > 0) {
+        while (indexw < width && collen > 0) {
           x = CVAL(in);
           if (x & 1) {
             x = x >> 1;
@@ -668,7 +668,7 @@
           indexw++;
           collen--;
         }
-        while (replen > 0) {
+        while (indexw < width && replen > 0) {
           x = last_line[indexw * 4] + color;
           *out = x;
           out += 4;
