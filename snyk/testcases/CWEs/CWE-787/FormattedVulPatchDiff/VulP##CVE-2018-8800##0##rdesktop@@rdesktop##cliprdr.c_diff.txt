--- /home/V1SCAN/CWE-787/FormattedVul/OLD##CVE-2018-8800##0##rdesktop@@rdesktop##cliprdr.c	2023-12-06 04:37:17.290325209 +0900
+++ /home/V1SCAN/CWE-787/FormattedPatch/NEW##CVE-2018-8800##0##rdesktop@@rdesktop##cliprdr.c	2023-12-06 04:37:19.010320999 +0900
@@ -109,6 +109,7 @@
   uint16 type, status;
   uint32 length, format;
   uint8 *data;
+  struct stream packet = *s;
 
   in_uint16_le(s, type);
   in_uint16_le(s, status);
@@ -118,6 +119,12 @@
   logger(Clipboard, Debug, "cliprdr_process(), type=%d, status=%d, length=%d",
          type, status, length);
 
+  if (!s_check_rem(s, length)) {
+    rdp_protocol_error(
+        "cliprdr_process(), consume of packet from stream would overrun",
+        &packet);
+  }
+
   if (status == CLIPRDR_ERROR) {
     switch (type) {
     case CLIPRDR_FORMAT_ACK:
