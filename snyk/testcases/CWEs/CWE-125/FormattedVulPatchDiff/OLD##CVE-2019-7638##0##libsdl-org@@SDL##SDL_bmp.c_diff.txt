--- /home/V1SCAN/CWE-125/FormattedVul/OLD##CVE-2019-7638##0##libsdl-org@@SDL##SDL_bmp.c	2023-12-01 06:27:18.886895291 +0900
+++ /home/V1SCAN/CWE-125/FormattedPatch/NEW##CVE-2019-7638##0##libsdl-org@@SDL##SDL_bmp.c	2023-12-01 06:27:17.706897087 +0900
@@ -310,6 +310,10 @@
     SDL_assert(biBitCount <= 8);
     if (biClrUsed == 0) {
       biClrUsed = 1 << biBitCount;
+    } else if (biClrUsed > (1 << biBitCount)) {
+      SDL_SetError("BMP file has an invalid number of colors");
+      was_error = SDL_TRUE;
+      goto done;
     }
     if ((int)biClrUsed > palette->ncolors) {
       SDL_Color *colors;
